<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://genshi.edgewall.org/">
    <head>
        <title>
            Site $site Overview
        </title>
        <script src="/jquery.min.js" type="text/javascript"></script>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="/bootstrap.css"/>
        <!-- Optional theme -->
        <link rel="stylesheet" href="/bootstrap.min.css"/>
        <!-- Latest compiled and minified JavaScript -->
        <script src="/bootstrap.min.js"></script>

        <script type='text/javascript' src='https://www.google.com/jsapi'></script>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <script type='text/javascript'>
//<![CDATA[
        google.load('visualization', '1', {packages:['table', 'controls']});
        $(document).ready(function() {
            load_data();
            //setInterval(load_data, 300000);
        });
        function draw_table(elID, table_vals){
        var dashboard = new google.visualization.Dashboard(document.getElementById(elID));
        var tableName = elID + '_table';
        var controlName = elID + '_control';
        var table = new google.visualization.ChartWrapper(
                {chartType: 'Table',
                 containerId: tableName,
                 options: {sortColumn: 0,
                           sortAscending: false,
                           allowHtml: true,
                           alternatingRowStyle: false,
                           page: 'enable',
                           cssClassNames: {headerRow: '1',
                                           tableRow: '1',
                                           oddTableRow: '1',
                                           selectedTableRow: '1',
                                           hoverTableRow: '1',
                                           headerCell: '1',
                                           tableCell: '1',
                                           rowNumberCell:'1'}}});
        var control = new google.visualization.ControlWrapper({
                 controlType: 'StringFilter',
                 containerId: controlName,
                 options: {filterColumnIndex: 0, matchType: 'any'}});
        dashboard.bind([control], [table]); 
        // I hate google table class. Sorry ;)
        google.visualization.events.addListener(table, 'ready', function(){
             $(".google-visualization-table-table").attr('class', 'table-bordered table-hover table-condensed table-striped');});
        dashboard.draw(table_vals);
        }


        function load_data() {
            var currentview = window.location['pathname'].split("/")[1];
            var siteName = window.location['pathname'].split("/")[2];
            var currentview = "/".concat(currentview, "/");
            document.getElementById('navbar-brand').setAttribute('href', currentview);
            document.getElementById("factory_entries").style.display = 'none';
            document.getElementById("pilots").style.display = 'none';
            document.getElementById("pilotsdebug").style.display = 'none';
            if (currentview == "/prodview/"){
                document.getElementById("navbar-brand").innerHTML = "Production Overview";
                $.get('json/$site', function(data){
                  gotTotals(data, currentview, siteName)});

                $.get('json/$site/summary', function(data){
                  gotSummary(data, currentview)});
            }
            else if (currentview == "/analysisview/"){
                document.getElementById("navbar-brand").innerHTML = "Analysis Overview";
                $.get('json/$site', function(data){
                  gotTotals(data, currentview, siteName)});
                $.get('json/$site/summary', function(data){
                  gotSummary(data, currentview)})
            }
            else if (currentview == "/totalview/"){
                document.getElementById("factory_entries").style.marginLeft = '1px';
                document.getElementById("factory_entries").style.display = 'inline';
                document.getElementById("pilots").style.marginLeft = '1px';
                document.getElementById("pilots").style.display = 'inline';
                document.getElementById("pilotsdebug").style.marginLeft = '1px';
                document.getElementById("pilotsdebug").style.display = 'inline';

                document.getElementById("navbar-brand").innerHTML = "Total Overview";
                document.getElementById("title").innerHTML = "Total Overview";
                $.get('json/$site/summary', function(data){
                  gotSummaryT(data, currentview)});
                $.get('/factoryview/json/$site/summary', function(data){
                  $.get('/factoryview/json/summary', function(data1){
                     gotSummaryFactory(data, data1, currentview, false, 'factory_entries_r')})});
            }
            else if (currentview == '/factoryview/' ){
                document.getElementById("workflows").style.marginLeft = '1px';
                document.getElementById("navbar-brand").innerHTML = "Factory Overview";
                document.getElementById("title").innerHTML = "Factory Overview";
               $.get('json/$site/summary', function(data){
                 $.get(currentview.concat('/json/summary'), function(data1){
                    gotSummaryFactory(data, data1, currentview, true, 'running_workflows')})})
            }
        }

        function gotSummaryFactory(data, data1, currentview, showTopStats, DataTable){
        var init = typeof showTopStats === "undefined" ? true : showTopStats;
        if (init)
        {
            $('#overall_stats_table').detach();
            pool_stats_table = $("<table></table>");
            pool_stats_table.addClass("table");
            pool_stats_table.attr('id', 'overall_stats_table');
            pool_stats_table.append("<tr><td>Errors</td><td>" + data.Summary.Errors + "</td></tr>");
            pool_stats_table.append("<tr><td>Warnings</td><td>" + data.Summary.Warnings + "</td></tr>");
            pool_stats_table.append("<tr><td>Running Pilots</td><td>" + data.Summary.Run + "</td></tr>");
            pool_stats_table.append("<tr><td>Idle Pilots/Total Idle</td><td>" + data.Summary.Idle + " / " + data.Summary.MIdle + "</td></tr>");
            pool_stats_table.append("<tr><td>Held Pilots/Total Held</td><td>" + data.Summary.Held + " / " + data.Summary.MHeld + "</td></tr>");
            $("#site_slots_table").append(pool_stats_table);
        
            $('#overall_hourly_img').detach();
            pool_hourly_img = $("<img></img>");
            pool_hourly_img.addClass("img");
            pool_hourly_img.attr('id', 'overall_hourly_img');
            pool_hourly_img.attr('src', currentview + 'graphs/$site/joint/hourly');
            $("#site_hourly_img").append(pool_hourly_img);

            $('#overall_daily_img').detach();
            pool_daily_img = $("<img></img>");  
            pool_daily_img.addClass("img");
            pool_daily_img.attr('id', 'overall_daily_img');
            pool_daily_img.attr('src', currentview + 'graphs/$site/joint/daily');
            $("#site_daily_img").append(pool_daily_img);

            $('#overall_weekly_img').detach();
            pool_weekly_img = $("<img></img>");
            pool_weekly_img.addClass("img");
            pool_weekly_img.attr('id', 'overall_weekly_img');
            pool_weekly_img.attr('src', currentview + 'graphs/$site/joint/weekly');
            $("#site_weekly_img").append(pool_weekly_img);
        }
        var table_data = new google.visualization.DataTable();
        table_data.addColumn("string", "Entry");
        table_data.addColumn("number", "Errors");
        table_data.addColumn("number", "Warnings");
        table_data.addColumn("number", "Running");
        table_data.addColumn("number", "Idle");
        table_data.addColumn("number", "Held");
        table_data.addColumn("string", "Siteview status");
        table_data.addColumn("string", "Idle status");
        table_data.addColumn("string", 'Held status');

        for (key in data) {
            if (key !== 'Summary' && key !== 'Errors'){
                for (key1 in data[key]){
                  sdata = data[key][key1];
                  var new_key = key1.replace(" ", "").toLowerCase() + key;
                  var image_html = '<img src="/factoryview/graphs/$site' + new_key + '"/>';
                  var factory_url = '';
                  if (key1 in data1.FactoryUrls)
                      factory_url = data1.FactoryUrls[key1]
                  var details = '<a target="_blank" href="' + factory_url + '">' + key1 + ' link </a><br/>';
                  details += '<a target="_blank" href="'+ factory_url +'/factoryEntryStatusNow.html?entry=' + key + '">'+ key +' link </a><br/>';
                  var errors = 0;
                  var warnings = 0;
                  if ('Error' in sdata){
                      errors = sdata.Error.length;
                      for (i = 0; i < errors; i++){
                          details += '<b>Error:</b> ' + sdata.Error[i] + '<br/>';
                      }
                  }
                  if ('Warning' in sdata){
                      warnings = sdata.Warning.length;
                      for (i = 0; i < warnings; i++){
                          details += '<b>Warning:</b> ' + sdata.Warning[i] + '<br/>';
                      }
                  }
                  var siteview = '<img src="/factoryview/graphs/$site/' + new_key + '/joint"/>';  
                  var idleview = '<img src="/factoryview/graphs/$site/' + new_key + '/idle"/>';
                  var heldview = '<img src="/factoryview/graphs/$site/' + new_key + '/held"/>';
                  table_data.addRow([details, errors, warnings, sdata.nowRunn, sdata.nowIdle, sdata.nowHeld, siteview, idleview, heldview]);
                  
            }}}
        draw_table(DataTable, table_data);
        }

        function gotSummaryT(data, currentview){
            $('#overall_stats_table').detach();
            pool_stats_table = $("<table></table>");
            pool_stats_table.addClass("table");
            pool_stats_table.attr('id', 'overall_stats_table');
            var total_tasks = 0;
            if ('analysisview' in data)
                total_tasks += data.analysisview.RequestCount;
            if ('prodview' in data)
                total_tasks += data.prodview.RequestCount;

            pool_stats_table.append("<tr><th></th><th>Running/CpusUse</th><th>Idle/CpusPen</th><th>Tasks</th></tr>");
            pool_stats_table.append("<tr><td>Total</td><td>" + data.Running + " / " + data.CpusInUse + "</td><td>"+ data.MatchingIdle +" / " + data.CpusPending + "</td><td>"+ total_tasks +"</td></tr>");
            if ('prodview' in data)
                pool_stats_table.append("<tr><td>Production</td><td>" + data.prodview.Running + " / " + data.prodview.CpusInUse + "</td><td>"+ data.prodview.MatchingIdle + " / " + data.prodview.CpusPending + "</td><td>"+ data.prodview.RequestCount +"</td></tr>");
            else
                pool_stats_table.append("<tr><td>Production</td><td>0</td><td>0</td><td>0</td></tr>");
            if ('analysisview' in data)
                pool_stats_table.append("<tr><td>Analysis</td><td>" + data.analysisview.Running + " / " + data.analysisview.CpusInUse +  "</td><td>"+ data.analysisview.MatchingIdle + " / " + data.analysisview.CpusPending +"</td><td>"+ data.analysisview.RequestCount +"</td></tr>");
            else
                pool_stats_table.append("<tr><td>Analysis</td><td>0</td><td>0</td><td>0</td></tr>");

            $("#site_slots_table").append(pool_stats_table);
            drawPoolStatsImgs(currentview);
            var table_data = new google.visualization.DataTable();
            table_data.addColumn("string", "Type");
            table_data.addColumn("string", 'Last Hour');
            table_data.addColumn("string", 'Last Day');
            table_data.addColumn("string", 'Last Week');

            // Add resource utilization as first entry
            var util_html_hourly = '<img src="/totalview/graphs/$site/utilization/hourly"/>';
            var util_html_daily = '<img src="/totalview/graphs/$site/utilization/daily"/>';
            var util_html_weekly = '<img src="/totalview/graphs/$site/utilization/weekly"/>';
            table_data.addRow(['Max Running Achieved', util_html_hourly, util_html_daily, util_html_weekly]);

            if ('prodview' in data){
                var image_html_hourly = '<img src="/prodview/graphs/$site/hourly"/>';
                var image_html_daily = '<img src="/prodview/graphs/$site/daily"/>';
                var image_html_weekly = '<img src="/prodview/graphs/$site/weekly"/>';
                var type_html = '<a href="/prodview/$site">Production</a>';
                table_data.addRow([type_html, image_html_hourly, image_html_daily, image_html_weekly]);
            }
            if ('analysisview' in data){
                var image_html_hourly = '<img src="/analysisview/graphs/$site/hourly"/>';
                var image_html_daily = '<img src="/analysisview/graphs/$site/daily"/>';
                var image_html_weekly = '<img src="/analysisview/graphs/$site/weekly"/>';
                var type_html = '<a href="/analysisview/$site">Analysis</a>';
                table_data.addRow([type_html, image_html_hourly, image_html_daily, image_html_weekly]);
            }
            draw_table('running_workflows', table_data);

            // Pilots usage graphs
            if ('PilotUsage' in data){
             var table_data = new google.visualization.DataTable();
             table_data.addColumn("string", "Type");
             table_data.addColumn("string", 'Last Hour');
             table_data.addColumn("string", 'Last Day');
             table_data.addColumn("string", 'Last Week');
             var types = ['Total', 'Partitionable', 'Static'];

             var pilots_html_hourly = '<img src="/totalview/graphs/$site/full/hourly"/>';
             var pilots_html_daily = '<img src="/totalview/graphs/$site/full/daily"/>';
             var pilots_html_weekly = '<img src="/totalview/graphs/$site/full/weekly"/>';
             table_data.addRow(['Totals', pilots_html_hourly, pilots_html_daily, pilots_html_weekly]);
 
             if ('Partitionable' in data['PilotUsage']){
             
                 var pilots_html_hourly = '<img src="/totalview/graphs/$site/partitionable/hourly"/>';
                 var pilots_html_daily = '<img src="/totalview/graphs/$site/partitionable/daily"/>';
                 var pilots_html_weekly = '<img src="/totalview/graphs/$site/partitionable/weekly"/>';
                 table_data.addRow(['Partitionable', pilots_html_hourly, pilots_html_daily, pilots_html_weekly]);
             }
             
             if ('Static' in data['PilotUsage']){
              
                 var pilots_html_hourly = '<img src="/totalview/graphs/$site/static/hourly"/>';
                 var pilots_html_daily = '<img src="/totalview/graphs/$site/static/daily"/>';
                 var pilots_html_weekly = '<img src="/totalview/graphs/$site/static/weekly"/>';
                 table_data.addRow(['Static', pilots_html_hourly, pilots_html_daily, pilots_html_weekly]);
             
             }
             draw_table('pilots_usage', table_data);

             if ('PilotUsage' in data){
               if ('Partitionable' in data['PilotUsage']){
                   if ('Utilization' in data['PilotUsage']['Partitionable']){
                     var table_data_debug = new google.visualization.DataTable();
                     table_data_debug.addColumn("number", "Counter");
                     table_data_debug.addColumn("number", 'Total Memory Available');
                     table_data_debug.addColumn("number", 'Memory Left');
                     table_data_debug.addColumn("number", 'Total Cpus');
                     table_data_debug.addColumn("number", 'Cpus Free');
                     table_data_debug.addColumn("string", 'Retire Time');
                     table_data_debug.addColumn("string", 'Die Time');
                     var pool_stats1 = new Array();
                     pool_stats1['NumberOfPilots'] = 0;
                     pool_stats1['NumberOfPilotsRetire'] = 0;
                     pool_stats1['NumberOfPilotsDie'] = 0;
                     pool_stats1['NumberOfCpusFreeRetire'] = 0;
                     pool_stats1['NumberOfCpusUseRetire'] = 0;
                     pool_stats1['NumberOfCpusFreeDie'] = 0;
                     pool_stats1['NumberOfCpusUseDie'] = 0;
                     var rowCounter = 0;
                     for (key in data['PilotUsage']['Partitionable']['Utilization']){
                       var itemvals = data['PilotUsage']['Partitionable']['Utilization'][key];
                       var retireTimemili = itemvals.RetireTime * 1000;
                       var retireTime = new Date(retireTimemili)
                       var milliseconds = new Date().getTime();
                       var dieTime = new Date(itemvals.DieTime *1000);
                       table_data_debug.addRow([itemvals.Counter, itemvals.TotalMemory, itemvals.Memory, itemvals.TotalSlotCpus, itemvals.Cpus,     retireTime.toLocaleString(), dieTime.toLocaleString()]);
                       pool_stats1['NumberOfPilots'] += itemvals.Counter;
                       var dieTimemili = (itemvals.DieTime - 3600) * 1000;
                       if (milliseconds > dieTimemili){
                          pool_stats1['NumberOfPilotsDie'] += itemvals.Counter;
                          pool_stats1['NumberOfCpusFreeDie'] += (itemvals.Counter * itemvals.Cpus);
                          pool_stats1['NumberOfCpusUseDie'] += (itemvals.Counter * (itemvals.TotalSlotCpus - itemvals.Cpus));
                          for (var i = 0; i <= 6; i++) {
                             table_data_debug.setProperty(rowCounter, i, 'style', 'background-color: #FF5050; color: black;');
                          }}
                       else if (milliseconds > retireTimemili)
                       {
                           pool_stats1['NumberOfPilotsRetire'] += itemvals.Counter;
                           pool_stats1['NumberOfCpusFreeRetire'] += (itemvals.Counter * itemvals.Cpus);
                           pool_stats1['NumberOfCpusUseRetire'] += (itemvals.Counter * (itemvals.TotalSlotCpus - itemvals.Cpus));
                           for (var i = 0; i <= 6; i++) {
                               table_data_debug.setProperty(rowCounter, i, 'style', 'background-color: #FFFACD; color: black;');
                           }}
                       rowCounter = rowCounter + 1; 
                     }
                     pool_stats1_table = $("<table></table>");
                     pool_stats1_table.addClass("table");
                     pool_stats1_table.attr('id', 'pilotsdebugtext_table');
                     pool_stats1_table.append("<tr><th>Information type</th><th>Numbers</th>");
                     pool_stats1_table.append("<tr><td>Number of Total Pilots</td><td>" + pool_stats1.NumberOfPilots + "</td>");
                     pool_stats1_table.append("<tr><td>Number of Pilots over the Retire time</td><td>" + pool_stats1.NumberOfPilotsRetire + "</td>");
                     pool_stats1_table.append("<tr><td>Number of CPUs in use in Pilots which are over the Retire time</td><td>" + pool_stats1.NumberOfCpusUseRetire + "</td>");
                     pool_stats1_table.append("<tr><td>Number of CPUs free in Pilots which are over the Retire time</td><td>" + pool_stats1.NumberOfCpusFreeRetire + "</td>");
                     pool_stats1_table.append("<tr><td>Number of Pilots will die in ~1 hour range</td><td>" + pool_stats1.NumberOfPilotsDie + "</t    d>");
                     pool_stats1_table.append("<tr><td>Number of CPUs in use in Pilots which are near die time (~1h range)</td><td>" + pool_stats1.NumberOfCpusUseDie + "</td>");
                     pool_stats1_table.append("<tr><td>Number of CPUs free in Pilots which are near die time (~1h range)</td><td>" + pool_stats1.NumberOfCpusFreeDie + "</td>");
                      $("#pilotsdebugtext").append(pool_stats1_table);

                     draw_table('pilotsdebugin', table_data_debug);
        }}}}}


        function gotSummary(data, currentview) {
            var table_data = new google.visualization.DataTable();
            if (currentview == "/prodview/"){
                table_data.addColumn("string", "Workflow");
                table_data.addColumn("number", "Running");
                table_data.addColumn("number", "Matching Idle");
                table_data.addColumn("number", "CpusUse");
                table_data.addColumn("number", "CpusPen");
                table_data.addColumn("number", "Matching Sites");
                table_data.addColumn("number", "Priority");
            }
            else if (currentview == "/analysisview/"){
                table_data.addColumn("string", "User");
                table_data.addColumn("number", "Running");
                table_data.addColumn("number", "Matching Idle");
                table_data.addColumn("number", "CpusUse");
                table_data.addColumn("number", "CpusPen");
                table_data.addColumn("number", "Matching Sites");
            }
            table_data.addColumn("string", 'Workflow History');

            for (workflow_key in data) {
                workflow_data = data[workflow_key];
                var image_html = '<img src="' + currentview + 'graphs/' + workflow_key + '/$site"/>';
                var workflow_html = '<a href="' + currentview + workflow_key + '">' + workflow_key + '</a>';
                if (currentview == "/prodview/")
                    table_data.addRow([workflow_html, workflow_data.Running, workflow_data.MatchingIdle, workflow_data.CpusInUse, workflow_data.CpusPending, workflow_data.MatchingSites, workflow_data.BasePrio, image_html]);
                else
                    table_data.addRow([workflow_html, workflow_data.Running, workflow_data.MatchingIdle, workflow_data.CpusInUse, workflow_data.CpusPending, workflow_data.MatchingSites, image_html]);
            }
            draw_table('running_workflows', table_data);
        }

        var pool_stats = new Array();
        function gotTotals(data, currentview, siteName) {
            pool_stats['Running'] = data.Running;
            pool_stats['RequestCount'] = data.RequestCount;
            pool_stats['MatchingIdle'] = data.MatchingIdle;
            pool_stats['CpusInUse'] = data.CpusInUse;
            pool_stats['CpusPending'] = data.CpusPending;
            pool_stats['UpdateDate'] = new Date(data.UpdateTime*1000);
            drawPoolStats(currentview, siteName);
        }

        function drawPoolStats(currentview, siteName) {
            $('#overall_stats_table').detach();
            pool_stats_table = $("<table></table>");
            pool_stats_table.addClass("table");
            pool_stats_table.attr('id', 'overall_stats_table');
            pool_stats_table.append("<tr><th>Running Jobs/CpusUse</th><th>Matching Idle Jobs/CpusPen</th><th>Request Count</th><th>Last Data Update</th>");
            pool_stats_table.append("<tr><td>" + pool_stats.Running + " / " + pool_stats.CpusInUse  + "</td><td>" + pool_stats.MatchingIdle + " / " + pool_stats.CpusPending  + "</td><td>" + pool_stats.RequestCount + "</td><td>" + pool_stats.UpdateDate.toLocaleString() + "</td></tr>");
            $("#site_slots_table").append(pool_stats_table);
            drawPoolStatsImgs(currentview, siteName);
        };


        function drawImg(srcUrl, customID, appendID){
          $('#' + customID).detach();
          pool_hourly_img = $("<img></img>");
          pool_hourly_img.addClass("img");
          pool_hourly_img.attr('id', customID);
          pool_hourly_img.attr('src', srcUrl);
          $("#"+ appendID).append(pool_hourly_img);
        }


        function drawPoolStatsImgs(currentview, siteName) {
            // Overview tab
            drawImg(currentview + 'graphs/$site/hourly', 'overall_hourly_img', 'site_hourly_img');
            drawImg('/totalview/graphs/$site/fairshare/hourly', 'overall_hourly_img1', 'site_hourly_img');
            drawImg(currentview + 'graphs/$site/daily', 'overall_daily_img', 'site_daily_img');
            drawImg('/totalview/graphs/$site/fairshare/daily', 'overall_daily_img1', 'site_daily_img');
            drawImg(currentview + 'graphs/$site/weekly', 'overall_weekly_img', 'site_weekly_img');
            drawImg('/totalview/graphs/$site/fairshare/weekly', 'overall_weekly_img1', 'site_weekly_img');

            if (currentview == "/prodview/")
            {
             document.getElementById("myTab").style.display = 'inline';
             // Job priority tab
             drawImg(currentview + 'graphs/siteprioritysummaryidle/$site/hourly', 'jobpriority_top_img11', 'jobpriority_top_img1');
             drawImg(currentview + 'graphs/siteprioritysummaryrunning/$site/hourly', 'jobpriority_top_img12', 'jobpriority_top_img1');
             drawImg(currentview + 'graphs/siteprioritysummaryidle/$site/daily', 'jobpriority_top_img21', 'jobpriority_top_img2');
             drawImg(currentview + 'graphs/siteprioritysummaryrunning/$site/daily', 'jobpriority_top_img22', 'jobpriority_top_img2');
             drawImg(currentview + 'graphs/siteprioritysummaryidle/$site/weekly', 'jobpriority_top_img31', 'jobpriority_top_img3');
             drawImg(currentview + 'graphs/siteprioritysummaryrunning/$site/weekly', 'jobpriority_top_img32', 'jobpriority_top_img3');
             // CPU priority tab
             drawImg(currentview + 'graphs/siteprioritysummarycpuspending/$site/hourly', 'cpupriority_top_img11', 'cpupriority_top_img1');
             drawImg(currentview + 'graphs/siteprioritysummarycpusinuse/$site/hourly', 'cpupriority_top_img12', 'cpupriority_top_img1');
             drawImg(currentview + 'graphs/siteprioritysummarycpuspending/$site/daily', 'cpupriority_top_img21', 'cpupriority_top_img2');
             drawImg(currentview + 'graphs/siteprioritysummarycpusinuse/$site/daily', 'cpupriority_top_img22', 'cpupriority_top_img2');
             drawImg(currentview + 'graphs/siteprioritysummarycpuspending/$site/weekly', 'cpupriority_top_img31', 'cpupriority_top_img3');
             drawImg(currentview + 'graphs/siteprioritysummarycpusinuse/$site/weekly', 'cpupriority_top_img32', 'cpupriority_top_img3');

             $.get('json/totals', function(totals_prod){
              $('#joboverall_priority_table').detach();
              pool_stats_table = $("<table></table>");
              pool_stats_table.addClass("table table-nonfluid");
              pool_stats_table.attr('id', 'joboverall_priority_table');
              pool_stats_table.append("<tr><th>Priority Type</th><th>Running</th><th>Idle</th></tr>");
              var keys = Object.keys(totals_prod.Priorities.Keys).sort();
              if (siteName in totals_prod.Priorities.Sites){
                  var siteVals = totals_prod.Priorities.Sites[siteName];
                  for (keyName in keys){
                      keyName = parseInt(keyName);
                      if (keys[keyName] in siteVals){
                          pool_stats_table.append("<tr><th>"+ totals_prod.Priorities.Keys[keys[keyName]] +"</th><td>" + siteVals[keys[keyName]].Running + "</td><td>" + siteVals[keys[keyName]].MatchingIdle + "</td></tr>");
                 	    }
                      else{
                          pool_stats_table.append("<tr><th>"+ totals_prod.Priorities.Keys[keys[keyName]] +"</th><td> None </td><td> None </td></tr>");
                      }
                  }
              }
              $("#jobpriority_slots_table").append(pool_stats_table);
              $('#coverall_priority_table').detach();
              pool_stats_table1 = $("<table></table>");
              pool_stats_table1.addClass("table table-nonfluid");
              pool_stats_table1.attr('id', 'coverall_priority_table');
              pool_stats_table1.append("<tr><th>Priority Type</th><th>CpusInUse</th><th>CpusPending</th></tr>");
              if (siteName in totals_prod.Priorities.Sites){
                  var siteVals = totals_prod.Priorities.Sites[siteName];
                  for (keyName in keys){
                      keyName = parseInt(keyName);
                      if (keys[keyName] in siteVals){
                         pool_stats_table1.append("<tr><th>"+ totals_prod.Priorities.Keys[keys[keyName]] +"</th><td>" + siteVals[keys[keyName]].CpusInUse + "</td><td>" + siteVals[keys[keyName]].CpusPending + "</td></    tr>");
                      }
                      else{
                         pool_stats_table1.append("<tr><th>"+ totals_prod.Priorities.Keys[keys[keyName]] +"</th><td> None </td><td> None </td></tr>");
                      }
                  }
              }
              $("#cpupriority_slots_table").append(pool_stats_table1);

             });


            }
            // TODO... Someday just fix this and have same as in the index

        }
//]]>
        </script>
    </head>
    <body>
    <nav class="navbar navbar-default" role="navigation">
         <div class="navbar-header">
          <button data-target=".navbar-ex1-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/" class="navbar-brand" id="navbar-brand">GWMS Overview</a>
         </div>
          <div class="navbar-collapse collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
              <li><a href="/">Main Page</a></li>
              <li><a href="/totalview">Total Overview</a></li>
              <li><a href="/prodview">Production Overview</a></li>
              <li><a href="/analysisview">Analysis Overview</a></li>
              <li><a href="/poolview">Pool Overview</a></li>
              <li><a href="/factoryview">Factory Overview</a></li>
          </ul>
          </div><!--/.nav-collapse -->
    </nav>
  <div class="container-fluid tab-pane">
      <ul class="nav nav-tabs" id="myTab" style="display:none">
         <li class="active"><a href="#overviewMain">Overview</a></li>
         <li><a href="#jobpriorityOverview">Job Priority Overview</a></li>
          <li><a href="#cpupriorityOverview">CPU Priority Overview</a></li>
      </ul>
      <div class="tab-content">
         <div class="tab-pane active" id="overviewMain">
            <div class="row jumbotron" id="top_summary" style="padding-top:10px">
                <div class="col-md-12">
                    <div class="col-md-3" style="padding-top:40px"><div id="site_slots_table"></div></div>
                    <div class="col-md-3">
                    <div class="row">
                        <h2>Last Hour</h2>
                        <div id="site_hourly_img"></div>
                    </div>
                    </div>
                    <div class="col-md-3">
                    <div class="row">
                        <h2>Last Day</h2>
                        <div id="site_daily_img"></div>
                    </div>
                    </div>
                    <div class="col-md-3">
                    <div class="row">
                        <h2>Last Week</h2>
                        <div id="site_weekly_img"></div>
                    </div></div></div>
                </div></div>
                <div class="tab-pane" id="jobpriorityOverview">
                  <div class="row jumbotron" id="top_summary" style="padding-top:10px">
                    <div class="col-md-12">
                    <div class="col-md-3" style="padding-top:40px"><div id="jobpriority_slots_table"></div></div>
                    <div class="col-md-3">
                    <div class="row">
                    <h2>Last Hour</h2>
                    <div id="jobpriority_top_img1"></div>
                    </div>
                    </div>
                     <div class="col-md-3">
                      <div class="row">
                                         <h2>Last Day</h2>
                                    <div id="jobpriority_top_img2"></div>
                                  </div>
                              </div>
                      <div class="col-md-3">
                        <div class="row">
                            <h2>Last Week</h2>
                           <div id="jobpriority_top_img3"></div>
                      </div></div></div>
                     </div>
                    </div>
                 <div class="tab-pane" id="cpupriorityOverview">
                  <div class="row jumbotron" id="top_summary" style="padding-top:10px">
                    <div class="col-md-12">
                    <div class="col-md-3" style="padding-top:40px"><div id="cpupriority_slots_table"></div></div>
                    <div class="col-md-3">
                    <div class="row">
                    <h2>Last Hour</h2>
                    <div id="cpupriority_top_img1"></div>
                    </div>
                    </div>
                     <div class="col-md-3">
                      <div class="row">
                                         <h2>Last Day</h2>
                                    <div id="cpupriority_top_img2"></div>
                                  </div>
                              </div>
                      <div class="col-md-3">
                        <div class="row">
                            <h2>Last Week</h2>
                           <div id="cpupriority_top_img3"></div>
                      </div></div></div>
                     </div>
                    </div>
            </div>
            <div class="row">
                <div class="col-md-1"></div>
                <div id="workflows" class="col-md-12">
                    <h2 id="title">
                        Running Requests 
                    </h2>
                    <div id="running_workflows">
                        <div id="running_workflows_control"></div>
                        <div id="running_workflows_table"></div>
                    </div>
                </div>
                 <div id="factory_entries" class="col-md-12">
                    <h2 id="title">
                        Factory entries
                    </h2>
                    <div id="factory_entries_r">
                        <div id="factory_entries_r_control"></div>
                        <div id="factory_entries_r_table"></div>
                    </div>
                </div>
                <div class="col-md-1"></div>
                <div id="pilots" class="col-md-12">
                   <h2 id="title">
                    Pilots usage
                   </h2>
                   <div id="pilots_usage">
                      <div id="pilots_usage_control"></div>
                      <div id="pilots_usage_table"></div>
                   </div>
                </div>
                <div id="pilotsdebug" class="col-md-5">
                   <h2 id="title">
                    Partitionable Pilots Info
                   </h2>
                   <div id="pilotsdebugin">
                      <div id="pilotsdebugin_control"></div>
                      <div id="pilotsdebugin_table"></div>
                   </div>
                </div>
                <div id="pilotsdebugtexttop" class="col-md-4"><h2>Grouped Statistics</h2><br/><div id="pilotsdebugtext"></div></div>
                <div class="col-md-1"></div>
            </div>
        </div>
    </body>
<script>
  $('#myTab a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');
  })
</script>
</html>

